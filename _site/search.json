[
  {
    "objectID": "src/create_maps.html",
    "href": "src/create_maps.html",
    "title": "Civic Opportunity Map",
    "section": "",
    "text": "Setup\nknitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)\n\n\nLoad pkgs\nif (!require(pacman)) install.packages(â€œpacmanâ€) pacman::p_load(leaflet, glue, sf, tigris, tidyverse, here, htmltools, htmlwidgets, DT)\n\n\nLoad data\ndf &lt;- read.csv(here(â€œraw_dataâ€, â€œcnty_counts_cov.csvâ€)) sum(df$FIPS == 9009) # including New Haven County\ncounties &lt;- readr::read_rds(here(â€œraw_dataâ€, â€œcounties.rdsâ€)) states &lt;- readr::read_rds(here(â€œraw_dataâ€, â€œstates.rdsâ€))\n\n\nData prep\ndf\\(fips &lt;- sprintf(\"%05d\", df\\)FIPS) sum(df\\(fips == \"09009\") # including New Haven County\nsetdiff(df\\)fips,counties$GEOID) # for some reason tigris::counties() does not include the following 8 counties in CT\n\n\nMerge datasets\nmap_data &lt;- left_join(counties, df, by = c(â€œGEOIDâ€ = â€œfipsâ€)) sum(map_data$FIPS == 9009) # doesnâ€™t include New Haven\n\n\nMerge state boundaries with map_data if necessary\nmap_data &lt;- st_as_sf(map_data) # Ensure itâ€™s an sf object map_data &lt;- st_transform(map_data, crs = st_crs(states)) # Match CRS\n\n\nCreate categorical bins (1 to 5)\nmap_data &lt;- map_data %&gt;% mutate(civic_opp_category = ntile(civic_opp_sum_normalized, 5)) # Divides into 5 groups (1-5)\n\n\nCreate an additional visualization tool\ndf &lt;- df %&gt;% mutate(FIPS = str_pad(as.character(FIPS), width = 5, side = â€œleftâ€, pad = â€œ0â€))\n\n\nLoad FIPS-to-county lookup\nfips_lookup &lt;- read_csv( â€œhttps://www2.census.gov/geo/docs/reference/codes/files/national_county.txtâ€, col_names = c(â€œstate_abbrâ€, â€œstate_fipsâ€, â€œcounty_fipsâ€, â€œcounty_nameâ€, â€œfips_classâ€), col_types = â€œcccccâ€ ) %&gt;% mutate(FIPS = str_c(state_fips, county_fips)) %&gt;% select(FIPS, county_name, state_abbr)\n\n\nNow safe to join\ndf_joined &lt;- df %&gt;% left_join(fips_lookup, by = â€œFIPSâ€) %&gt;% filter(!is.na(county_name)) %&gt;% mutate( civic_opp_percentile = percent_rank(civic_opp_sum_normalized), civic_opp_percentile_label = case_when( civic_opp_percentile &gt;= 0.99 ~ â€œTop 1%â€, civic_opp_percentile &gt;= 0.95 ~ â€œTop 5%â€, civic_opp_percentile &gt;= 0.90 ~ â€œTop 10%â€, civic_opp_percentile &gt;= 0.75 ~ â€œTop 25%â€, civic_opp_percentile &gt;= 0.50 ~ â€œTop 50%â€, civic_opp_percentile &gt;= 0.25 ~ â€œBottom 50%â€, civic_opp_percentile &gt;= 0.10 ~ â€œBottom 25%â€, civic_opp_percentile &gt;= 0.05 ~ â€œBottom 10%â€, TRUE ~ â€œBottom 5%â€ ) )\n\n\nUI\nui &lt;- fluidPage( titlePanel(â€œFind Similar Counties by Civic Opportunity Scoreâ€), sidebarLayout( sidebarPanel( selectInput(â€œselected_stateâ€, â€œSelect a State:â€, choices = sort(unique(df_joined$state_abbr))),\n  selectInput(\"selected_county\", \"Select a County:\",\n              choices = NULL)  # we'll update this dynamically\n),\nmainPanel(\n  h4(\"10 Most Similar Counties + Selected (with Percentile)\"),\n  DTOutput(\"similar_table\")\n)\n) )\n\n\nServer\nserver &lt;- function(input, output, session) { # Update county list when state changes observeEvent(input\\(selected_state, {\n    counties_in_state &lt;- df_joined %&gt;%\n      filter(state_abbr == input\\)selected_state) %&gt;% arrange(county_name) %&gt;% pull(county_name) %&gt;% unique()\nupdateSelectInput(session, \"selected_county\",\n                  choices = counties_in_state,\n                  selected = counties_in_state[1])\n})\noutput\\(similar_table &lt;- renderDT({\n    req(input\\)selected_county)\nselected_row &lt;- df_joined %&gt;%\n  filter(county_name == input$selected_county, state_abbr == input$selected_state)\n\ntarget_score &lt;- selected_row$civic_opp_sum_normalized\n\nsimilar_rows &lt;- df_joined %&gt;%\n  filter(!(county_name == input$selected_county & state_abbr == input$selected_state)) %&gt;%\n  mutate(score_diff = abs(civic_opp_sum_normalized - target_score)) %&gt;%\n  arrange(score_diff) %&gt;%\n  head(10)\n\ncombined &lt;- bind_rows(selected_row, similar_rows) %&gt;%\n  select(county_name, state_abbr, civic_opp_sum_normalized, civic_opp_percentile_label) %&gt;%\n  arrange(civic_opp_sum_normalized)\n\ndatatable(combined, rownames = FALSE, options = list(dom = 't')) %&gt;%\n  formatStyle(\n    'county_name',\n    target = 'row',\n    backgroundColor = styleEqual(input$selected_county, 'lightgreen')\n  )\n}) } ```"
  },
  {
    "objectID": "index.html",
    "href": "index.html",
    "title": "MapAgorg Dashboard",
    "section": "",
    "text": "Welcome\nThis dashboard visualizes the geography of civic infrastructure and opportunity in the United States."
  },
  {
    "objectID": "index.html#get-started",
    "href": "index.html#get-started",
    "title": "MapAgorg Dashboard",
    "section": "",
    "text": "ğŸ‘‰ Use the Explore Map tab to interact with civic opportunity data.\nğŸ“Š Data includes counts, per capita rates, and classifications"
  },
  {
    "objectID": "map.html",
    "href": "map.html",
    "title": "Civic Opportunity Map",
    "section": "",
    "text": "Load packages\nif (!requireNamespace(â€œpacmanâ€, quietly = TRUE)) install.packages(â€œpacmanâ€) pacman::p_load(leaflet, glue, sf, tigris, tidyverse, here, htmlwidgets, viridis, DT)\n\n\nLoad and prepare data\ndf &lt;- read.csv(here::here(â€œraw_dataâ€, â€œcnty_counts_cov.csvâ€)) df\\(fips &lt;- sprintf(\"%05d\", df\\)FIPS)\ncounties &lt;- readr::read_rds(here::here(â€œraw_dataâ€, â€œcounties.rdsâ€)) states &lt;- readr::read_rds(here::here(â€œraw_dataâ€, â€œstates.rdsâ€))\nmap_data &lt;- left_join(counties, df, by = c(â€œGEOIDâ€ = â€œfipsâ€)) %&gt;% st_as_sf() %&gt;% st_transform(crs = st_crs(states)) %&gt;% mutate( civic_opp_category = ntile(civic_opp_sum_normalized, 5), county_info = glue(â€œ{NAMELSAD}Civic opportunity index: {round(civic_opp_index, 2)}Civic orgs per 1k: {round(civic_opp_sum_normalized, 2)}â€) )\n\n\nDefine color palette\npal_green &lt;- colorFactor(viridis(5), domain = map_data$civic_opp_category)\n\n\nRender map\nleaflet(map_data, options = leafletOptions(minZoom = 3)) %&gt;% addProviderTiles(â€œCartoDB.Positronâ€) %&gt;% addPolygons( fillColor = ~pal_green(civic_opp_category), fillOpacity = 0.7, color = â€œ#BDBDC1â€, weight = 1, popup = ~county_info, group = â€œCountiesâ€ ) %&gt;% addPolygons( data = states, color = â€œblackâ€, weight = 2, fillOpacity = 0, group = â€œStatesâ€, options = pathOptions(clickable = FALSE) ) %&gt;% addLegend( pal = pal_green, values = map_data$civic_opp_category, title = â€œCivic Opportunity Indexâ€, position = â€œbottomrightâ€ ) %&gt;% addScaleBar(position = â€œbottomleftâ€) %&gt;% addEasyButton( easyButton( icon = â€œfa-globeâ€, title = â€œReset Zoomâ€, onClick = JS(â€œfunction(btn, map){ map.setView([37.0902, -95.7129], 4); }â€) ) ) %&gt;% addMouseCoordinates() %&gt;% # Mouse coordinates control setView(lng = -95.7129, lat = 37.0902, zoom = 4) %&gt;% # Remove default zoom and geolocation control: removeControl(â€œzoomâ€) %&gt;% removeControl(â€œgeolocateâ€)"
  },
  {
    "objectID": "about.html",
    "href": "about.html",
    "title": "About",
    "section": "",
    "text": "This dashboard is powered by the MapAgora datasets, derived from IRS tax returns of tax-exempt organizations and their websites.\n\nDeveloper and maintainer: Jae Yeon Kim and Milan de Vries"
  },
  {
    "objectID": "similar_counties.html",
    "href": "similar_counties.html",
    "title": "Civic Opportunity Map",
    "section": "",
    "text": "[1] 1\n\n\n[1] 1\n\n\n[1] \"09001\" \"09003\" \"09005\" \"09007\" \"09009\" \"09011\" \"09013\" \"09015\"\n\n\n[1] NA"
  }
]