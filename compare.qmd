---
title: "Compare Counties & States"
format:
  html:
    page-layout: full
    self-contained: true
execute:
  echo: false
  warning: false
  message: false
---

```{r setup, include=FALSE}
# Suppress all package loading messages
suppressPackageStartupMessages({
  if (!require(pacman, quietly = TRUE)) install.packages("pacman", quiet = TRUE)
  pacman::p_load(tidyverse, here, htmltools, DT, plotly, jsonlite, quiet = TRUE)
})

# Load civic opportunity data
civic_data <- read.csv(here("raw_data", "cnty_counts_cov.csv")) %>%
  mutate(fips = sprintf("%05d", FIPS))

# Load org type data
org_types <- read.csv(here("raw_data", "cnty_civic_org_type.csv")) %>%
  mutate(fips = sprintf("%05d", FIPS)) %>%
  filter(!is.na(class)) %>%
  group_by(fips, class) %>%
  summarise(count = sum(freq, na.rm = TRUE), .groups = "drop") %>%
  group_by(fips) %>%
  mutate(total = sum(count), pct = round(100 * count / total, 2)) %>%
  ungroup() %>%
  select(fips, class, pct) %>%
  pivot_wider(names_from = class, values_from = pct, values_fill = 0)

# Load FIPS-to-county lookup
fips_lookup <- suppressMessages(read_csv(
  "https://www2.census.gov/geo/docs/reference/codes/files/national_county.txt",
  col_names = c("state_abbr", "state_fips", "county_fips", "county_name", "fips_class"),
  col_types = "ccccc",
  show_col_types = FALSE
)) %>%
  mutate(FIPS = str_c(state_fips, county_fips)) %>%
  select(FIPS, county_name, state_abbr)

# Join data
df_full <- civic_data %>%
  mutate(FIPS = sprintf("%05d", FIPS)) %>%
  left_join(fips_lookup, by = "FIPS") %>%
  left_join(org_types, by = c("FIPS" = "fips")) %>%
  filter(!is.na(county_name)) %>%
  mutate(
    civic_opp_index = ntile(civic_opp_sum_normalized, 5),
    civic_opp_percentile = percent_rank(civic_opp_sum_normalized)
  )

# State-level aggregation with all 15 organization types
state_summary <- df_full %>%
  group_by(state_abbr) %>%
  summarise(
    n_counties = n(),
    total_population = sum(TotalPopulation, na.rm = TRUE),
    total_civic_orgs = sum(civic_org_sum, na.rm = TRUE),
    total_nonprofits = sum(n, na.rm = TRUE),
    avg_civic_index = round(mean(civic_opp_index, na.rm = TRUE), 2),
    median_civic_score = round(median(civic_opp_sum_normalized, na.rm = TRUE), 0),
    # All 15 organization types
    avg_arts_cultural_pct = round(mean(`Arts & Cultural`, na.rm = TRUE), 1),
    avg_community_pct = round(mean(Community, na.rm = TRUE), 1),
    avg_economic_pct = round(mean(Economic, na.rm = TRUE), 1),
    avg_education_pct = round(mean(Education, na.rm = TRUE), 1),
    avg_foundations_pct = round(mean(Foundations, na.rm = TRUE), 1),
    avg_healthcare_pct = round(mean(Healthcare, na.rm = TRUE), 1),
    avg_hobby_sports_pct = round(mean(`Hobby & Sports`, na.rm = TRUE), 1),
    avg_housing_pct = round(mean(Housing, na.rm = TRUE), 1),
    avg_political_pct = round(mean(Political, na.rm = TRUE), 1),
    avg_professional_pct = round(mean(Professional, na.rm = TRUE), 1),
    avg_religious_pct = round(mean(Religious, na.rm = TRUE), 1),
    avg_research_pct = round(mean(`Research & Think Tank`, na.rm = TRUE), 1),
    avg_fraternal_pct = round(mean(`Social & Fraternal`, na.rm = TRUE), 1),
    avg_unions_pct = round(mean(Unions, na.rm = TRUE), 1),
    avg_youth_pct = round(mean(Youth, na.rm = TRUE), 1),
    .groups = "drop"
  ) %>%
  arrange(desc(avg_civic_index))
```

This page allows you to compare civic opportunity across states and counties. Use the tabs below to explore patterns and differences.

::: {.panel-tabset}

## State Comparison

Compare civic opportunity metrics across all 50 states plus DC. Select two states from the dropdowns to compare side-by-side.

```{r state-compare-setup}
# Prepare state data for JavaScript with all 15 organization types
state_json <- state_summary %>%
  rename(
    state = state_abbr,
    counties = n_counties,
    population = total_population,
    civic_orgs = total_civic_orgs,
    nonprofits = total_nonprofits,
    avg_index = avg_civic_index,
    median_score = median_civic_score,
    arts_cultural = avg_arts_cultural_pct,
    community = avg_community_pct,
    economic = avg_economic_pct,
    education = avg_education_pct,
    foundations = avg_foundations_pct,
    healthcare = avg_healthcare_pct,
    hobby_sports = avg_hobby_sports_pct,
    housing = avg_housing_pct,
    political = avg_political_pct,
    professional = avg_professional_pct,
    religious = avg_religious_pct,
    research = avg_research_pct,
    fraternal = avg_fraternal_pct,
    unions = avg_unions_pct,
    youth = avg_youth_pct
  )

state_data_json <- jsonlite::toJSON(state_json, dataframe = "rows")
```

```{r state-compare-ui}
htmltools::tagList(
  tags$div(
    class = "compare-selectors",
    style = "display: flex; gap: 20px; margin-bottom: 20px; flex-wrap: wrap;",
    tags$div(
      style = "flex: 1; min-width: 200px;",
      tags$label(style = "font-weight: bold; display: block; margin-bottom: 5px;", "State A:"),
      tags$select(
        id = "state-a-select",
        class = "state-selector",
        style = "width: 100%; padding: 8px;",
        onchange = "updateStateCompare()",
        tags$option(value = "", "Select a state...")
      )
    ),
    tags$div(
      style = "flex: 1; min-width: 200px;",
      tags$label(style = "font-weight: bold; display: block; margin-bottom: 5px;", "State B:"),
      tags$select(
        id = "state-b-select",
        class = "state-selector",
        style = "width: 100%; padding: 8px;",
        onchange = "updateStateCompare()",
        tags$option(value = "", "Select a state...")
      )
    )
  ),
  tags$div(
    id = "state-compare-results",
    class = "compare-container",
    style = "display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; margin-bottom: 2em;",
    tags$p(style = "color: #666; grid-column: 1 / -1;", "Select two states above to compare them.")
  ),
  tags$script(HTML(paste0("
    var stateData = ", state_data_json, ";

    function populateStateSelectors() {
      var selectA = document.getElementById('state-a-select');
      var selectB = document.getElementById('state-b-select');

      stateData.sort(function(a, b) {
        return a.state.localeCompare(b.state);
      });

      stateData.forEach(function(s) {
        var optA = document.createElement('option');
        optA.value = s.state;
        optA.textContent = s.state;
        selectA.appendChild(optA);

        var optB = document.createElement('option');
        optB.value = s.state;
        optB.textContent = s.state;
        selectB.appendChild(optB);
      });
    }

    function getStateByAbbr(abbr) {
      return stateData.find(function(s) { return s.state === abbr; });
    }

    function updateStateCompare() {
      var stateA = document.getElementById('state-a-select').value;
      var stateB = document.getElementById('state-b-select').value;
      var resultsDiv = document.getElementById('state-compare-results');

      if (!stateA || !stateB) {
        resultsDiv.innerHTML = '<p style=\"color: #666; grid-column: 1 / -1;\">Select two states above to compare them.</p>';
        return;
      }

      var dataA = getStateByAbbr(stateA);
      var dataB = getStateByAbbr(stateB);

      if (!dataA || !dataB) {
        resultsDiv.innerHTML = '<p style=\"color: red;\">Error loading state data.</p>';
        return;
      }

      function renderStateCard(state) {
        var indexColor = state.avg_index >= 4 ? '#a5d6a7' : state.avg_index >= 3 ? '#c8e6c9' : state.avg_index >= 2 ? '#fff9c4' : '#ffe0b2';

        // Find primary org type (highest percentage)
        var orgTypes = [
          { name: 'Arts & Cultural', value: state.arts_cultural || 0 },
          { name: 'Community', value: state.community || 0 },
          { name: 'Economic', value: state.economic || 0 },
          { name: 'Education', value: state.education || 0 },
          { name: 'Foundations', value: state.foundations || 0 },
          { name: 'Healthcare', value: state.healthcare || 0 },
          { name: 'Hobby & Sports', value: state.hobby_sports || 0 },
          { name: 'Housing', value: state.housing || 0 },
          { name: 'Political', value: state.political || 0 },
          { name: 'Professional', value: state.professional || 0 },
          { name: 'Religious', value: state.religious || 0 },
          { name: 'Research & Think Tank', value: state.research || 0 },
          { name: 'Social & Fraternal', value: state.fraternal || 0 },
          { name: 'Unions', value: state.unions || 0 },
          { name: 'Youth', value: state.youth || 0 }
        ];
        var maxOrg = orgTypes.reduce(function(a, b) { return a.value > b.value ? a : b; });

        function orgRow(name, value) {
          var isPrimary = name === maxOrg.name;
          var cls = isPrimary ? 'compare-metric primary-org-type' : 'compare-metric';
          var style = 'display: flex; justify-content: space-between; padding: 0.3em 0;' + (isPrimary ? '' : '');
          return '<div class=\"' + cls + '\" style=\"' + style + '\"><span>' + name + '</span><span>' + value.toFixed(1) + '%</span></div>';
        }

        return '<div class=\"compare-card\" style=\"background: white; border: 1px solid #ddd; border-radius: 8px; padding: 1.5em;\">' +
          '<h3 style=\"margin: 0 0 1em 0; padding-bottom: 0.5em; border-bottom: 3px solid ' + indexColor + ';\">' + state.state + '</h3>' +
          '<div class=\"compare-metric\" style=\"display: flex; justify-content: space-between; padding: 0.5em 0; border-bottom: 1px solid #eee;\">' +
          '<span style=\"color: #666;\">Avg Civic Opportunity Index</span><span style=\"font-weight: bold; font-size: 1.2em; color: #4CAF50;\">' + state.avg_index.toFixed(2) + ' / 5</span></div>' +
          '<div class=\"compare-metric\" style=\"display: flex; justify-content: space-between; padding: 0.5em 0; border-bottom: 1px solid #eee;\">' +
          '<span style=\"color: #666;\">Median Score (per 100k)</span><span style=\"font-weight: bold;\">' + state.median_score + '</span></div>' +
          '<div class=\"compare-metric\" style=\"display: flex; justify-content: space-between; padding: 0.5em 0; border-bottom: 1px solid #eee;\">' +
          '<span style=\"color: #666;\">Number of Counties</span><span style=\"font-weight: bold;\">' + state.counties + '</span></div>' +
          '<div class=\"compare-metric\" style=\"display: flex; justify-content: space-between; padding: 0.5em 0; border-bottom: 1px solid #eee;\">' +
          '<span style=\"color: #666;\">Total Civic Orgs</span><span style=\"font-weight: bold;\">' + state.civic_orgs.toLocaleString() + '</span></div>' +
          '<div class=\"compare-metric\" style=\"display: flex; justify-content: space-between; padding: 0.5em 0; border-bottom: 1px solid #eee;\">' +
          '<span style=\"color: #666;\">Total Nonprofits</span><span style=\"font-weight: bold;\">' + state.nonprofits.toLocaleString() + '</span></div>' +
          '<h4 style=\"margin: 1em 0 0.5em 0; font-size: 14px; color: #666;\">Avg Organization Types (%) <span style=\"font-size: 11px; color: #ffc107;\">â˜… Primary Provider</span></h4>' +
          orgRow('Arts & Cultural', state.arts_cultural || 0) +
          orgRow('Community', state.community || 0) +
          orgRow('Economic', state.economic || 0) +
          orgRow('Education', state.education || 0) +
          orgRow('Foundations', state.foundations || 0) +
          orgRow('Healthcare', state.healthcare || 0) +
          orgRow('Hobby & Sports', state.hobby_sports || 0) +
          orgRow('Housing', state.housing || 0) +
          orgRow('Political', state.political || 0) +
          orgRow('Professional', state.professional || 0) +
          orgRow('Religious', state.religious || 0) +
          orgRow('Research & Think Tank', state.research || 0) +
          orgRow('Social & Fraternal', state.fraternal || 0) +
          orgRow('Unions', state.unions || 0) +
          orgRow('Youth', state.youth || 0) +
          '</div>';
      }

      resultsDiv.innerHTML = renderStateCard(dataA) + renderStateCard(dataB);
    }

    document.addEventListener('DOMContentLoaded', populateStateSelectors);
  ")))
)
```

## County Comparison

Select two counties from the dropdowns below to compare them side-by-side. Counties are listed as "County Name, State" to disambiguate counties with the same name.

```{r county-compare-setup}
# Prepare data for JavaScript - include all organization types
county_json <- df_full %>%
  select(
    fips = FIPS,
    state = state_abbr,
    county = county_name,
    civic_index = civic_opp_index,
    civic_score = civic_opp_sum_normalized,
    civic_orgs = civic_org_sum,
    total_orgs = n,
    # All 15 organization types
    arts_cultural = `Arts & Cultural`,
    community = Community,
    economic = Economic,
    education = Education,
    foundations = Foundations,
    healthcare = Healthcare,
    hobby_sports = `Hobby & Sports`,
    housing = Housing,
    political = Political,
    professional = Professional,
    religious = Religious,
    research = `Research & Think Tank`,
    fraternal = `Social & Fraternal`,
    unions = Unions,
    youth = Youth,
    # Opportunity types
    membership = membership_sum,
    volunteer = volunteer_sum,
    events = events_sum,
    action = take_action_sum
  ) %>%
  mutate(civic_score = round(civic_score, 0))

# Convert to JSON for JavaScript
county_data_json <- jsonlite::toJSON(county_json, dataframe = "rows")
```

```{r county-compare-ui}
htmltools::tagList(
  tags$div(
    class = "compare-selectors",
    style = "display: flex; gap: 20px; margin-bottom: 20px; flex-wrap: wrap;",
    tags$div(
      style = "flex: 1; min-width: 250px; position: relative;",
      tags$label(style = "font-weight: bold; display: block; margin-bottom: 5px;", "County A:"),
      tags$input(
        type = "text",
        id = "county-a-input",
        class = "county-search-input",
        placeholder = "Type to search counties...",
        autocomplete = "off"
      ),
      tags$input(type = "hidden", id = "county-a-fips"),
      tags$div(id = "county-a-dropdown", class = "county-dropdown")
    ),
    tags$div(
      style = "flex: 1; min-width: 250px; position: relative;",
      tags$label(style = "font-weight: bold; display: block; margin-bottom: 5px;", "County B:"),
      tags$input(
        type = "text",
        id = "county-b-input",
        class = "county-search-input",
        placeholder = "Type to search counties...",
        autocomplete = "off"
      ),
      tags$input(type = "hidden", id = "county-b-fips"),
      tags$div(id = "county-b-dropdown", class = "county-dropdown")
    )
  ),
  tags$div(
    id = "county-compare-results",
    class = "compare-container",
    style = "display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px;",
    tags$p(style = "color: #666; grid-column: 1 / -1;", "Select two counties above to compare them.")
  ),
  tags$script(HTML(paste0("
    var countyData = ", county_data_json, ";

    // Sort counties by state then name
    countyData.sort(function(a, b) {
      if (a.state !== b.state) return a.state.localeCompare(b.state);
      return a.county.localeCompare(b.county);
    });

    function setupCountySearch(inputId, dropdownId, fipsId) {
      var input = document.getElementById(inputId);
      var dropdown = document.getElementById(dropdownId);
      var fipsInput = document.getElementById(fipsId);

      input.addEventListener('input', function() {
        var query = this.value.toLowerCase().trim();
        fipsInput.value = ''; // Clear selection when typing

        if (query.length < 1) {
          dropdown.style.display = 'none';
          dropdown.innerHTML = '';
          return;
        }

        var matches = countyData.filter(function(c) {
          var fullName = (c.county + ', ' + c.state).toLowerCase();
          return fullName.indexOf(query) !== -1;
        }).slice(0, 50); // Limit to 50 results

        if (matches.length === 0) {
          dropdown.innerHTML = '<div class=\"county-dropdown-item\" style=\"color: #999;\">No matches found</div>';
          dropdown.style.display = 'block';
          return;
        }

        dropdown.innerHTML = matches.map(function(c) {
          return '<div class=\"county-dropdown-item\" data-fips=\"' + c.fips + '\">' + c.county + ', ' + c.state + '</div>';
        }).join('');
        dropdown.style.display = 'block';
      });

      input.addEventListener('focus', function() {
        if (this.value.length >= 1) {
          this.dispatchEvent(new Event('input'));
        }
      });

      dropdown.addEventListener('click', function(e) {
        if (e.target.classList.contains('county-dropdown-item') && e.target.dataset.fips) {
          input.value = e.target.textContent;
          fipsInput.value = e.target.dataset.fips;
          dropdown.style.display = 'none';
          updateCountyCompare();
        }
      });

      // Close dropdown when clicking outside
      document.addEventListener('click', function(e) {
        if (!input.contains(e.target) && !dropdown.contains(e.target)) {
          dropdown.style.display = 'none';
        }
      });
    }

    function getCountyByFips(fips) {
      return countyData.find(function(c) { return c.fips === fips; });
    }

    function updateCountyCompare() {
      var fipsA = document.getElementById('county-a-fips').value;
      var fipsB = document.getElementById('county-b-fips').value;
      var resultsDiv = document.getElementById('county-compare-results');

      if (!fipsA || !fipsB) {
        resultsDiv.innerHTML = '<p style=\"color: #666; grid-column: 1 / -1;\">Select two counties above to compare them.</p>';
        return;
      }

      var countyA = getCountyByFips(fipsA);
      var countyB = getCountyByFips(fipsB);

      if (!countyA || !countyB) {
        resultsDiv.innerHTML = '<p style=\"color: red;\">Error loading county data.</p>';
        return;
      }

      function renderCard(county) {
        var indexColor = ['#ffcdd2', '#ffe0b2', '#fff9c4', '#c8e6c9', '#a5d6a7'][county.civic_index - 1] || '#eee';
        return '<div class=\"compare-card\" style=\"background: white; border: 1px solid #ddd; border-radius: 8px; padding: 1.5em;\">' +
          '<h3 style=\"margin: 0 0 1em 0; padding-bottom: 0.5em; border-bottom: 3px solid ' + indexColor + ';\">' + county.county + ', ' + county.state + '</h3>' +
          '<div class=\"compare-metric\" style=\"display: flex; justify-content: space-between; padding: 0.5em 0; border-bottom: 1px solid #eee;\">' +
          '<span style=\"color: #666;\">Civic Opportunity Index</span><span style=\"font-weight: bold; font-size: 1.2em; color: #4CAF50;\">' + county.civic_index + ' / 5</span></div>' +
          '<div class=\"compare-metric\" style=\"display: flex; justify-content: space-between; padding: 0.5em 0; border-bottom: 1px solid #eee;\">' +
          '<span style=\"color: #666;\">Civic Opp Score (per 100k)</span><span style=\"font-weight: bold;\">' + county.civic_score + '</span></div>' +
          '<div class=\"compare-metric\" style=\"display: flex; justify-content: space-between; padding: 0.5em 0; border-bottom: 1px solid #eee;\">' +
          '<span style=\"color: #666;\">Civic Opportunity Orgs</span><span style=\"font-weight: bold;\">' + county.civic_orgs + '</span></div>' +
          '<div class=\"compare-metric\" style=\"display: flex; justify-content: space-between; padding: 0.5em 0; border-bottom: 1px solid #eee;\">' +
          '<span style=\"color: #666;\">Total Nonprofits</span><span style=\"font-weight: bold;\">' + county.total_orgs + '</span></div>' +
          '<h4 style=\"margin: 1em 0 0.5em 0; font-size: 14px; color: #666;\">Organization Types (%)</h4>' +
          '<div class=\"compare-metric\" style=\"display: flex; justify-content: space-between; padding: 0.3em 0;\"><span>Arts & Cultural</span><span>' + (county.arts_cultural || 0).toFixed(1) + '%</span></div>' +
          '<div class=\"compare-metric\" style=\"display: flex; justify-content: space-between; padding: 0.3em 0;\"><span>Community</span><span>' + (county.community || 0).toFixed(1) + '%</span></div>' +
          '<div class=\"compare-metric\" style=\"display: flex; justify-content: space-between; padding: 0.3em 0;\"><span>Economic</span><span>' + (county.economic || 0).toFixed(1) + '%</span></div>' +
          '<div class=\"compare-metric\" style=\"display: flex; justify-content: space-between; padding: 0.3em 0;\"><span>Education</span><span>' + (county.education || 0).toFixed(1) + '%</span></div>' +
          '<div class=\"compare-metric\" style=\"display: flex; justify-content: space-between; padding: 0.3em 0;\"><span>Foundations</span><span>' + (county.foundations || 0).toFixed(1) + '%</span></div>' +
          '<div class=\"compare-metric\" style=\"display: flex; justify-content: space-between; padding: 0.3em 0;\"><span>Healthcare</span><span>' + (county.healthcare || 0).toFixed(1) + '%</span></div>' +
          '<div class=\"compare-metric\" style=\"display: flex; justify-content: space-between; padding: 0.3em 0;\"><span>Hobby & Sports</span><span>' + (county.hobby_sports || 0).toFixed(1) + '%</span></div>' +
          '<div class=\"compare-metric\" style=\"display: flex; justify-content: space-between; padding: 0.3em 0;\"><span>Housing</span><span>' + (county.housing || 0).toFixed(1) + '%</span></div>' +
          '<div class=\"compare-metric\" style=\"display: flex; justify-content: space-between; padding: 0.3em 0;\"><span>Political</span><span>' + (county.political || 0).toFixed(1) + '%</span></div>' +
          '<div class=\"compare-metric\" style=\"display: flex; justify-content: space-between; padding: 0.3em 0;\"><span>Professional</span><span>' + (county.professional || 0).toFixed(1) + '%</span></div>' +
          '<div class=\"compare-metric\" style=\"display: flex; justify-content: space-between; padding: 0.3em 0;\"><span>Religious</span><span>' + (county.religious || 0).toFixed(1) + '%</span></div>' +
          '<div class=\"compare-metric\" style=\"display: flex; justify-content: space-between; padding: 0.3em 0;\"><span>Research & Think Tank</span><span>' + (county.research || 0).toFixed(1) + '%</span></div>' +
          '<div class=\"compare-metric\" style=\"display: flex; justify-content: space-between; padding: 0.3em 0;\"><span>Social & Fraternal</span><span>' + (county.fraternal || 0).toFixed(1) + '%</span></div>' +
          '<div class=\"compare-metric\" style=\"display: flex; justify-content: space-between; padding: 0.3em 0;\"><span>Unions</span><span>' + (county.unions || 0).toFixed(1) + '%</span></div>' +
          '<div class=\"compare-metric\" style=\"display: flex; justify-content: space-between; padding: 0.3em 0;\"><span>Youth</span><span>' + (county.youth || 0).toFixed(1) + '%</span></div>' +
          '<h4 style=\"margin: 1em 0 0.5em 0; font-size: 14px; color: #666;\">Opportunity Types</h4>' +
          '<div class=\"compare-metric\" style=\"display: flex; justify-content: space-between; padding: 0.3em 0;\"><span>Membership Orgs</span><span>' + county.membership + '</span></div>' +
          '<div class=\"compare-metric\" style=\"display: flex; justify-content: space-between; padding: 0.3em 0;\"><span>Volunteer Orgs</span><span>' + county.volunteer + '</span></div>' +
          '<div class=\"compare-metric\" style=\"display: flex; justify-content: space-between; padding: 0.3em 0;\"><span>Event Orgs</span><span>' + county.events + '</span></div>' +
          '<div class=\"compare-metric\" style=\"display: flex; justify-content: space-between; padding: 0.3em 0;\"><span>Action Orgs</span><span>' + county.action + '</span></div>' +
          '</div>';
      }

      resultsDiv.innerHTML = renderCard(countyA) + renderCard(countyB);
    }

    // Initialize on page load
    document.addEventListener('DOMContentLoaded', function() {
      setupCountySearch('county-a-input', 'county-a-dropdown', 'county-a-fips');
      setupCountySearch('county-b-input', 'county-b-dropdown', 'county-b-fips');
    });
  ")))
)
```

## Methodology Notes

::: {.callout-note}
## Understanding the Comparisons

**State-Level Aggregations**:

- **Avg Index**: Average of the civic opportunity index (1-5) across all counties in the state
- **Median Score**: Median civic opportunity score per 100,000 residents
- **Organization type percentages**: Average percentage across counties (not weighted by population)

**Comparison Limitations**:

- County size varies dramatically, from a few thousand to millions of residents
- Per-capita scores help normalize for population, but don't account for geographic accessibility
- Organization types are predicted by machine learning (~90% accuracy)

For detailed methodology, see the [Learn page](learn.qmd).
:::

:::

<style>
.state-selector:focus {
  outline: none;
  border-color: #4CAF50;
}

.compare-card {
  transition: box-shadow 0.2s ease;
}

.compare-card:hover {
  box-shadow: 0 4px 12px rgba(0,0,0,0.1);
}

/* Searchable county dropdown styles */
.county-search-input {
  width: 100%;
  padding: 10px 14px;
  border: 1px solid #ccc;
  border-radius: 4px;
  font-size: 15px;
  box-sizing: border-box;
}

.county-search-input:focus {
  outline: none;
  border-color: #4CAF50;
  box-shadow: 0 0 0 2px rgba(76, 175, 80, 0.2);
}

.county-dropdown {
  display: none;
  position: absolute;
  top: 100%;
  left: 0;
  right: 0;
  max-height: 300px;
  overflow-y: auto;
  background: white;
  border: 1px solid #4CAF50;
  border-top: none;
  border-radius: 0 0 4px 4px;
  z-index: 1000;
  box-shadow: 0 4px 12px rgba(0,0,0,0.15);
}

.county-dropdown-item {
  padding: 10px 14px;
  cursor: pointer;
  font-size: 14px;
  border-bottom: 1px solid #f0f0f0;
}

.county-dropdown-item:nth-child(odd) {
  background: #fafafa;
}

.county-dropdown-item:hover {
  background: #e8f5e9 !important;
}

.county-dropdown-item[data-fips]:hover {
  background: #c8e6c9 !important;
}

/* Primary org type highlight */
.primary-org-type {
  background: #fff3cd !important;
  font-weight: bold;
  border-left: 3px solid #ffc107;
  padding-left: 9px !important;
}
</style>
